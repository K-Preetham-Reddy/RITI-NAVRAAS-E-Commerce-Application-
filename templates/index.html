<!DOCTYPE html>
<html>
<head>
    <title>Products</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <h1>Our Products</h1>
    <div class="product-container">
        {% for p in products %}
        <div class="card">
            <img src="{{ p[1] }}" alt="Product Image">
            <h3>{{ p[2] }}</h3>
            <p>{{ p[3] }}</p>
            <p>â‚¹{{ p[4] }}</p>
            <button onclick="addToCart('{{ p[0] }}')">Add to Cart</button>
        </div>
        {% endfor %}
    </div>
    <div id="cart-panel">
        <h3>Your Cart</h3>
        <ul id="cart-items"></ul>
        <button onclick="goToCheckout()">Purchase</button>
    </div>

    <script>
        let cart = {};

        function addToCart(productId) {
            if(cart[productId]) {
                cart[productId]++;
            } else {
                cart[productId] = 1;
            }
            renderCart();
        }

        function renderCart() {
            let cartList = document.getElementById("cart-items");
            cartList.innerHTML = "";
            for (let id in cart) {
                let li = document.createElement("li");
                li.innerText = "Product " + id + " x " + cart[id];
                cartList.appendChild(li);
            }
        }

        function goToCheckout() {
            fetch("/checkout", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(cart)
            })
            .then(res => res.json())
            .then(data => {
                sessionStorage.setItem("checkoutData", JSON.stringify(data));
                window.location.href = "/checkout-page";
            });
        }
    </script>
</body>
</html>
